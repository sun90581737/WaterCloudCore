<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>@ViewBag.ProjectName</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta http-equiv="Access-Control-Allow-Origin" content="*">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link rel="icon" href="@ViewBag.LogoIcon">
    <link rel="stylesheet" href="~/lib/layui-v2.5.5/css/layui.css" media="all">
    <link rel="stylesheet" href="~/css/login.css" media="all">
</head>
<body>
    @*动画特效*@
    <div id="starsBox"></div>
    <div id="OngridList" class="layui-container">
        <div class="admin-login-background">
            <div class="layui-form login-form">
                <form class="layui-form" action="">
                    <div class="layui-form-item logo-title">
                        <h1>@ViewBag.ProjectName</h1>
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-icon layui-icon-username" for="username"></label>
                        <input type="text" id="username" lay-verify="required|account" placeholder="用户名" autocomplete="off" class="layui-input" value="@ViewBag.UserName">
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-icon layui-icon-password" for="password"></label>
                        <input type="password" id="password" lay-verify="required|password" placeholder="密码" autocomplete="off" class="layui-input" value="@ViewBag.Password">
                    </div>
                    <div class="layui-form-item">
                        <label class="layui-icon layui-icon-vercode" for="captcha"></label>
                        <div class="code">
                            <input id="captcha" type="text" name="captcha" lay-verify="required|captcha" placeholder="图形验证码" autocomplete="off" class="layui-input verification captcha">
                            <canvas id="canvas" width="100" height="43"></canvas>
                        </div>
                    </div>
                    <div class="layui-form-item">
                        <span>
                            <input type="checkbox" name="remember_user" id="remember_user" lay-skin="primary" style="vertical-align:middle;" value="true">
                            <span style="color:#303030;vertical-align:middle;">记住密码</span>
                        </span>
                    </div>
                    <div class="layui-form-item">
                        <div class="login_tips"></div>
                        <button id="login_button" class="layui-btn layui-btn-fluid" style="background-color:#ffa231;color:#fff" lay-submit="" lay-filter="login">登 入</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    <div>
        <div id="a1" style="position: absolute; width: 5%;height: 16%;transform: rotate(60deg); left: 6%; top: 39%;"></div>
        <img id="a2" src="/images/login-bj/01.png" style="pointer-events: none;display:none; width: 223px; height: 150px; position: absolute; left: 3%; top: 30%; background: url('/images/login-bj/01.png') 0 0 / 100% 100% no-repeat; " />
    </div>
    <div>
        <div id="b1" style="position: absolute; width: 5%;height: 11%;transform: rotate(125deg); left: 17%; top: 24%;"></div>
        <img id="b2" src="/images/login-bj/02.png" style="pointer-events: none;display:none; width: 223px; height: 150px; position: absolute; left: 17%; top: 12%; background: url('/images/login-bj/02.png') 0 0 / 100% 100% no-repeat; " />
    </div>
    <div>
        <div id="c1" style="position: absolute; width: 4%;height: 13%;transform: rotate(60deg); left: 27%; top: 13%;"></div>
        <img id="c2" src="/images/login-bj/03.png" style="pointer-events: none;display:none; width: 223px; height: 150px; position: absolute; left: 28%; top: 2%; background: url('/images/login-bj/03.png') 0 0 / 100% 100% no-repeat; " />
    </div>
    <div>
        <div id="d1" style="position: absolute; width: 9%;height: 14%;transform: rotate(-29deg); left: 33%; top: 22%;"></div>
        <img id="d2" src="/images/login-bj/04.png" style="pointer-events: none;display:none; width: 223px; height: 150px; position: absolute; left: 36%; top:11%; background: url('/images/login-bj/04.png') 0 0 / 100% 100% no-repeat; " />
    </div>
    <div>
        <div id="e1" style="position: absolute; width: 10%;height: 14%;transform: rotate(30deg); left: 58%; top: 28%;"></div>
        <img id="e2" src="/images/login-bj/05.png" style="pointer-events: none;display:none; width: 223px; height: 150px; position: absolute; left: 61%; top: 17%; background: url('/images/login-bj/05.png') 0 0 / 100% 100% no-repeat; " />
    </div>
    <div>
        <div id="f1" style="position: absolute; width: 6%;height: 8%;transform: rotate(145deg); left: 58%; top: 54%;"></div>
        <img id="f2" src="/images/login-bj/06.png" style="pointer-events: none;display:none; width: 223px; height: 150px; position: absolute; left: 59%; top: 39%; background: url('/images/login-bj/06.png') 0 0 / 100% 100% no-repeat; " />
    </div>
    <div>
        <div id="g1" style="position: absolute; width: 17%;height: 5%;transform: rotate(149deg); left: 32%; top: 54%;"></div>
        <img id="g2" src="/images/login-bj/07.png" style="pointer-events: none;display:none; width: 223px; height: 150px; position: absolute; left: 40%; top: 38%; background: url('/images/login-bj/07.png') 0 0 / 100% 100% no-repeat; " />
    </div>
    <div>
        <div id="h1" style="position: absolute; width: 6%;height: 12%;transform: rotate(30deg); left: 16%; top: 49%;"></div>
        <img id="h2" src="/images/login-bj/08.png" style="pointer-events: none;display:none; width: 223px; height: 150px; position: absolute; left: 17%; top: 36%; background: url('/images/login-bj/08.png') 0 0 / 100% 100% no-repeat; " />
    </div>
    <div>
        <div id="i1" style="position: absolute; width: 5%;height: 17%;transform: rotate(-58deg); left: 9%; top: 55%;"></div>
        <img id="i2" src="/images/login-bj/09.png" style="pointer-events: none;display:none; width: 223px; height: 150px; position: absolute; left: 8%; top: 66%; background: url('/images/login-bj/09.png') 0 0 / 100% 100% no-repeat; " />
    </div>
    <div>
        <div id="j1" style="position: absolute; width: 7%;height: 22%;transform: rotate(-58deg); left: 23%; top: 65%;"></div>
        <img id="j2" src="/images/login-bj/10.png" style="pointer-events: none;display:none; width: 223px; height: 150px; position: absolute; left: 22%; top: 77%; background: url('/images/login-bj/10.png') 0 0 / 100% 100% no-repeat; " />
    </div>
    <div>
        <div id="k1" style="position: absolute; width: 4%;height: 20%;transform: rotate(60deg); left: 63%; top: 57%;"></div>
        <img id="k2" src="/images/login-bj/11.png" style="pointer-events: none;display:none; width: 223px; height: 150px; position: absolute; left: 61%; top: 69%; background: url('/images/login-bj/11.png') 0 0 / 100% 100% no-repeat; " />
    </div>
    <style>
    </style>
    <script src="~/lib/jquery-3.4.1/jquery-3.4.1.min.js" charset="utf-8"></script>
    <script src="~/js/cookie/jquery.cookie.js"></script>
    <script src="~/js/md5/jquery.md5.js"></script>
    <script src="~/lib/layui-v2.5.5/layui.js" charset="utf-8"></script>
    <script src="~/lib/jq-module/jquery.particleground.min.js" charset="utf-8"></script>
    <script src="~/js/login.js?v=@WaterCloud.Code.GlobalContext.GetVersion()"></script>
    <script src="~/js/framework-ui.js?v=@WaterCloud.Code.GlobalContext.GetVersion()"></script>
    <script>
        (function ($) {
            var s = window.screen.width / 1920;
            document.body.style.transformOrigin = '0 0';
            document.body.style.transform = 'scale(' + s + ',' + s + ')';
            document.body.style.width = window.innerWidth / s + 'px';
            document.body.style.height = window.innerHeight / s + 'px';

            var sUserAgent = navigator.userAgent.toLowerCase();
            var bIsIpad = sUserAgent.match(/ipad/i) == "ipad";
            var bIsIphoneOs = sUserAgent.match(/iphone os/i) == "iphone os";
            var bIsMidp = sUserAgent.match(/midp/i) == "midp";
            var bIsUc7 = sUserAgent.match(/rv:1.2.3.4/i) == "rv:1.2.3.4";
            var bIsUc = sUserAgent.match(/ucweb/i) == "ucweb";
            var bIsAndroid = sUserAgent.match(/android/i) == "android";
            var bIsCE = sUserAgent.match(/windows ce/i) == "windows ce";
            var bIsWM = sUserAgent.match(/windows mobile/i) == "windows mobile";

            if (bIsIpad || bIsIphoneOs || bIsMidp || bIsUc7 || bIsUc || bIsAndroid || bIsCE || bIsWM) {
                //跳转移动端页面
                top.location.href = "/Login/Form";
            }
            $('#a1').hover(function () {
                $('#a2').fadeIn('slow');
            }, function () {
                $('#a2').fadeOut('slow', function () {
                });
            });
            $('#b1').hover(function () {
                $('#b2').fadeIn('slow');
            }, function () {
                $('#b2').fadeOut('slow', function () {
                });
            });
            $('#c1').hover(function () {
                $('#c2').fadeIn('slow');
            }, function () {
                $('#c2').fadeOut('slow', function () {
                });
            });
            $('#d1').hover(function () {
                $('#d2').fadeIn('slow');
            }, function () {
                $('#d2').fadeOut('slow', function () {
                });
            });
            $('#e1').hover(function () {
                $('#e2').fadeIn('slow');
            }, function () {
                $('#e2').fadeOut('slow', function () {
                });
            });
            $('#f1').hover(function () {
                $('#f2').fadeIn('slow');
            }, function () {
                $('#f2').fadeOut('slow', function () {
                });
            });
            $('#g1').hover(function () {
                $('#g2').fadeIn('slow');
            }, function () {
                $('#g2').fadeOut('slow', function () {
                });
            });
            $('#h1').hover(function () {
                $('#h2').fadeIn('slow');
            }, function () {
                $('#h2').fadeOut('slow', function () {
                });
            });
            $('#i1').hover(function () {
                $('#i2').fadeIn('slow');
            }, function () {
                $('#i2').fadeOut('slow', function () {
                });
            });
            $('#j1').hover(function () {
                $('#j2').fadeIn('slow');
            }, function () {
                $('#j2').fadeOut('slow', function () {
                });
            });
            $('#k1').hover(function () {
                $('#k2').fadeIn('slow');
            }, function () {
                $('#k2').fadeOut('slow', function () {
                });
            });

            var show_num = [];
            $.login = {
                formMessage: function (msg) {
                    $('.login_tips').find('.tips_msg').remove();
                    $('.login_tips').append('<div class="tips_msg"><i class="fa fa-question-circle"></i>' + msg + '</div>');
                },
                init: function () {
                    $("#canvas").click(function () {
                        draw(show_num);
                    });
                    var login_error = top.$.cookie('WaterCloud_login_error');
                    if (login_error != null) {
                        switch (login_error) {
                            case "overdue":
                                $.login.formMessage('系统登录已超时,请重新登录');
                                break;
                            case "OnLine":
                                $.login.formMessage('您的帐号已在其它地方登录,请重新登录');
                                break;
                            case "-1":
                                $.login.formMessage('系统未知错误,请重新登录');
                                break;
                        }
                        top.$.cookie('WaterCloud_login_error', '', { path: "/", expires: -1 });
                    }
                },
                checkLogin: function () {
                    $.ajax({
                        url: "/Login/CheckLoginState?v=" + new Date().Format("yyyy-MM-dd hh:mm:ss"),
                        type: "post",
                        async: false,
                        dataType: "json",
                        success: function (data) {
                            if (data.state == "success") {
                                 window.location.href = '@Url.Content("~/Home/Index")';
                            }
                        }
                    });
                }
            };
            $(function () {
                $.login.init();
                $.login.checkLogin();
                draw(show_num);
                if ($.cookie("remember_user")) {
                    $("#remember_user").prop("checked", true);
                    $("#username").val($.cookie("username"));
                    $("#password").val($.cookie("password"));
                }
            });
            function saveUserInfo() {
                if ($("#remember_user").prop("checked") == true) {
                    var user_name = $("#username").val();
                    var user_password = $("#password").val();
                    $.cookie("remember_user", "true", {
                        expires: 7
                    }); // 存储一个带7天期限的 cookie
                    $.cookie("username", user_name, {
                        expires: 7
                    }); // 存储一个带7天期限的 cookie
                    $.cookie("password", user_password, {
                        expires: 7
                    }); // 存储一个带7天期限的 cookie
                } else {
                    $.cookie("remember_user", "false", {
                        expires: -1
                    }); // 删除 cookie
                    $.cookie("username", '', {
                        expires: -1
                    });
                    $.cookie("password", '', {
                        expires: -1
                    });
                }
            }
            layui.use(['form'], function () {
                var form = layui.form,
                    layer = layui.layer;
                // 登录过期的时候，跳出ifram框架
                if (top.location != self.location) top.location = self.location;

                // 进行登录操作
                form.on('submit(login)', function (data) {
                    saveUserInfo();
                    data = data.field;
                    if (data.username == '') {
                        layer.msg('用户名不能为空', { offset: ['338px', '1210px'] });
                        return false;
                    }
                    if (data.password == '') {
                        layer.msg('密码不能为空', { offset: ['338px', '1210px'] });
                        return false;
                    }
                    var num = show_num.join("");
                    if (data.captcha == '') {
                        layer.msg('验证码不能为空', { offset: ['338px', '1210px'] });
                        return false;
                    }
                    else if (num != data.captcha.toLowerCase()) {
                        layer.msg('验证码错误', { offset:['338px','1210px']});
                        draw(show_num)
                        return false;
                    }
                    $("#login_button").empty();
                    $("#login_button").attr('disabled', 'disabled').html("loading...");
                    $.ajax({
                        url: "/Login/CheckLogin?v=" + new Date().Format("yyyy-MM-dd hh:mm:ss"),
                        data: { username: $.trim($('#username').val()), localurl: location.host, password: $.md5($.trim($('#password').val())) },
                        type: "post",
                        dataType: "json",
                        success: function (data) {
                            if (data.state == "success") {
                                $("#login_button").empty();
                                $("#login_button").html("登录成功，正在跳转...");
                                if (data.url != null && data.url != "") {
                                    window.location.href = '@Url.Content("~/Home/Index")' + data.url;
                                }
                                else {
                                    window.location.href = '@Url.Content("~/Home/Index")';
                                }
                            } else {
                                $("#login_button").empty();
                                $("#login_button").removeAttr('disabled').html("登 入");
                                draw(show_num);
                                layer.msg(data.message, { offset: ['338px', '1210px'] });
                                $.login.formMessage(data.message);
                            }
                        },
                        error: function () {
                            $("#login_button").empty();
                            $("#login_button").removeAttr('disabled').html("登 入");
                            draw(show_num);
                            layer.msg("系统未知错误,请重新登录", { offset: ['338px', '1210px'] });
                            $.login.formMessage("系统未知错误,请重新登录");
                        }

                    });

                    return false;
                });
            });
        })(jQuery);
    </script>
</body>
</html>